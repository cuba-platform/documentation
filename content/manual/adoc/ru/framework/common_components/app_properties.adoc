:sourcesdir: ../../../../source

[[app_properties]]
==== Свойства приложения

Свойства приложения − именованные значения различных типов, определяющие всевозможные аспекты конфигурации и функционирования приложения. Свойства приложения широко используются в платформе, и могут применяться в приложении для решения аналогичных задач.

По назначению свойства приложения можно классифицировать следующим образом:

* _Конфигурационные параметры_ - задают наборы конфигурационных файлов и некоторые параметры пользовательского интерфейса, т.е. определяют функциональность приложения. Значения конфигурацинных параметров обычно задаются при разработке приложения.
+
Например: <<cuba.springContextConfig,cuba.springContextConfig>>.

* _Параметры развертывания_ - различные URL для соединения <<app_tiers,блоков>> приложения, тип используемой БД, настройки безопасности и т.д. Значения параметров развертывания обычно зависят от окружения, в котором устанавливается данный экземпляр приложения.
+
Например: <<cuba.connectionUrlList,cuba.connectionUrlList>>, <<cuba.dbmsType,cuba.dbmsType>>, <<cuba.userSessionExpirationTimeoutSec,cuba.userSessionExpirationTimeoutSec>>.

* _Параметры времени выполнения_ - активность аудита, параметры отсылки email и т.д. Параметры времени выполнения могут быть изменены при необходимости во время работы приложения без его перезапуска.
+
Например: <<cuba.entityLog.enabled,cuba.entityLog.enabled>>, <<cuba.email._,cuba.email.smtpHost>>.

[[setting_app_properties]]
Задание свойств приложения::
+
--
Значения свойств приложения могут быть заданы в <<app_properties_db,базе данных>>, в <<app_properties_files,файлах свойств>>, через системные свойства Java или переменные окружения ОС. Если свойство с некоторым именем задано в нескольких источниках, его значение определяется в следующем приоритете:

. Системное свойство Java (высший приоритет)
. Переменная окружения ОС
. Файл свойств
. База данных (низший приоритет)

Например, значение, заданное в файле, переопределяет одноименное значение, заданное в БД.

Для переменных окружения ОС фреймворк пытается сначала найти точное соответствие по имени свойства, и если такой переменной нет, то ищется переменная с именем в верхнем регистре и с подчеркиваниями вместо точек. Например, переменная окружения `MYAPP_SOMEPROPERTY` может задать значение свойству `myapp.someProperty`. Для того, чтобы запретить возможность использования имен в верхнем регистре с подчеркиваниями, установите свойство приложения `cuba.disableUppercaseEnvironmentProperties` в true.

Некоторые свойства не поддерживают установку свойств в базе данных по причине того, что их значения требуются еще до того, как БД становится доступной приложению. Это параметры конфигурации и развертывания. Поэтому их можно устанавливать только в файлах свойств,  через системные свойства Java или переменные окружения ОС. Параметры времени выполнения всегда могут быть установлены в базе данных (и, возможно, переопределены в файле или системными свойствами).

Как правило, некоторое свойство используется только в одном или нескольких <<app_tiers,блоках>> приложения. Например, <<cuba.persistenceConfig,cuba.persistenceConfig>> необходимо только для Middleware, <<cuba.web.appWindowMode,cuba.web.appWindowMode>> − только для Web Client, а <<cuba.springContextConfig,cuba.springContextConfig>> − для всех блоков. Это означает, что если нужно задать значение некоторому свойству, это необходимо сделать _во всех блоках_, в которых данное свойство используется. Свойства, хранящиеся в БД, доступны всем блокам, поэтому они устанавливаются в одном месте (в таблице базы данных), независимо от того, в каких блоках они используются. Более того, платформа предоставляет экран *Administration > Application Properties* для управления свойствами, хранящимися в БД. Свойства, хранящиеся в файлах, должны быть установлены одновременно в соответствующих файлах блоков приложения.

[TIP]
====
Когда вам необходимо установить значение свойству приложения, определенному платформой, найдите это свойство в <<app_properties_reference,документации>>. Если в документации сказано, что свойство хранится в БД, для установки значения используйте экран *Administration > Application Properties*. В противном случае выясните в документации, какие блоки приложения используют свойство, и установите значение в файлах `app.properties` этих блоков. Например, если в документации сказано, что свойство используется во всех блоках, а ваше приложение состоит из Middleware и Web Client, установите свойство в файле `app.properties` модуля *core* и в файле `web-app.properties` модуля *web*. Параметры развертывания можно также установить вне проекта в файле `local.app.properties`. Подробнее см. <<app_properties_files>>.
====
--

[[component_app_properties]]
Свойства из компонентов приложения::
+
--
--
<<app_components,Компонент приложения>> может предоставлять свойства путем объявления их в файле <<app-component.xml,app-component.xml>>. Тогда если приложение, использующее компонент, не задает собственное значение свойства, значение будет получено из компонента. Если приложение использует несколько компонентов, предоставляющих одно и то же свойство, значение будет получено из компонента, который является ближайшим предком в иерархии зависимостей между компонентами. Если существует несколько компонентов на одном уровне иерархии, то значение свойства непредсказуемо.

[[additive_app_properties]]
Аддитивные свойства::
+
--
Иногда необходимо получить объединенное значение свойства из всех компонентов, используемых в приложении. Это особенно актуально для конфигурационных параметров, которые позволяют механизмам платформы конфигурировать приложение на основании свойств, предоставляемых компонентами приложения.

Такие свойства должны быть сделаны _аддитивными_ путем добавления знака плюс в начале значения. Этот знак говорит о том, что значение свойства во время выполнения должно быть собрано из компонентов приложения. Например, <<cuba.persistenceConfig,cuba.persistenceConfig>> - аддитивное свойство. В вашем проекте оно задает файл `persistence.xml`, определяющий модель данных проекта. Однако вследствие того, что реальное значение свойства будет также включать файлы `persistence.xml` компонентов приложения, полная модель данных вашего приложения будет включать также и сущности, определенные в компонентах.

Если знак `+` опустить, то значение будет получено только из текущего проекта. Это может быть полезным в случае, если наследование некоторой конфигурации из компонентов не требуется, например, при определении структуры главного меню.

Значение аддитивного свойства, полученное во время выполнения, состоит из отдельных значений, разделенных _пробелом_.
--

[[app_properties_access]]
Программный доступ к свойствам приложения::
+
--
Доступ к свойствам из кода приложения можно получить следующими способами:

* Через <<config_interfaces,конфигурационный интерфейс>>. Если определить свойства с помощью аннотированных методов конфигурационного интерфейса, то код приложения будет иметь типизированный доступ к этим свойствам. Конфигурационные интерфейсы позволяют работать со свойствами всех типов хранения: в базе данных, в файлах и системных свойствах.

* Методом `getProperty()` класса <<appContext,AppContext>>. Если вы установили свойство в файле или в системном свойстве Java, то код приложения может прочитать значение с помощью этого метода. Данный подход имеет следующие недостатки:
** Не поддерживаются свойства, хранящиеся в базе данных.
** В отличие от вызова метода интерфейса, вам необходимо передавать имя свойства в строке.
** В отличие от получения результата нужного типа, вы можете получить только строковое значение свойства.
--

include::app_properties/app_properties_files.adoc[]

include::app_properties/app_properties_db.adoc[]

include::app_properties/config_interfaces.adoc[]


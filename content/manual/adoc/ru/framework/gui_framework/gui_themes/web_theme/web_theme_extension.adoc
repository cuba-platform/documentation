:sourcesdir: ../../../../../../source

[[web_theme_extension]]
====== Расширение существующей темы

Существующая в платформе тема может быть изменена в проекте приложения. В измененной теме можно сделать следующее:

* Изменить изображения для фирменного стиля.

* Добавить изображения для использования в визуальных компонентах.

* Создать новые стили и использовать их в атрибутах <<gui_attr_stylename,stylename>> визуальных компонентов. Для этого требуется знание CSS.

* Изменить существующие в платформе стили компонентов.

* Изменить общие параметры, такие как цвет фона, отступы, промежутки и т.д.

[[web_theme_extension_structure]]
Структура темы и скрипты сборки::
+
--
Тема описывается в файлах link:$$http://sass-lang.com$$[SCSS]. Для изменения (расширения) темы в проекте необходимо создать специальную файловую структуру в модуле *web*.

Это удобно сделать с помощью *CUBA Studio*: откройте секцию *Project properties* и нажмите ссылку *Create theme extension*. В диалоговом окне выберите тему, которую вы хотите расширить. Другой способ - использовать команду `theme` в https://www.cuba-platform.ru/marketplace/cuba-cli[CUBA CLI].

В результате в проекте будет создана следующая структура каталогов (для расширения темы Halo):

[source, plain]
----
include::{sourcesdir}/gui/themes/themes_42.scss[]
----

Кроме того, скрипт сборки <<build.gradle,build.gradle>> будет дополнен задачей `buildScssThemes`, автоматически запускаемой при сборке модуля *web*. Опциональная задача <<build.gradle_deployThemes,deployThemes>> может быть использована для быстрого применения изменений в темах на работающем приложении.

[TIP]
====
Если ваше приложение включает в себя <<app_components,компонент>> с расширением темы и вы хотите применить это расширение ко всему приложению, в этом случае необходимо создать расширение темы и для базового проекта. Подробнее о наследовании тем смотрите в разделе <<web_theme_inheritance,Наследование тем из компонентов приложения>>.
====
--

[[web_theme_extension_branding]]
Изменение фирменного стиля::
+
--
Можно настроить некоторые параметры фирменного стиля (branding): значки и заголовки окна логина и главного окна, значок вебсайта `favicon.ico`.

Для использования собственных изображений, замените соответствующие файлы в каталоге `modules/web/themes/halo/branding`.

Чтобы задать заголовки главного окна, окна логина и текст приглашения окна логина, в CUBA Studio откройте *Project properties* → *Edit* и нажмите кнопку *Branding* внизу страницы. Используйте соответствующие ссылки для задания заголовков окон и текста приглашения окна логина.

Данные параметры сохраняются в <<main_message_pack,главном пакете сообщений>> модуля *web* (то есть в файле `modules/web/<root_package>/web/messages.properties` и его вариантах для разных локалей). Использование пакетов сообщений дает возможность использовать разные файлы изображений для разных локалей пользователей. Пример содержимого файла `messages.properties`:

[source, plain]
----
include::{sourcesdir}/gui/themes/themes_43.scss[]
----

Путь к `favicon.ico` указывать не нужно, он должен обязательно находится в корне каталога с именем темы.
--

[[web_theme_extension_fonts]]
Добавление шрифтов::
+
--
В приложение можно добавить собственные шрифты. Для добавления семейства шрифтов импортируйте его в первой строке файла `styles.scss`, например:

[source, properties]
----
@import url(http://fonts.googleapis.com/css?family=Roboto);
----
--

[[web_theme_extension_styles]]
Создание новых стилей::
+
--
Рассмотрим пример установки желтого цвета фона для поля, отображающего название заказчика.

В XML-дескрипторе экрана определен компонент <<gui_FieldGroup,FieldGroup>>:

[source, xml]
----
include::{sourcesdir}/gui/themes/themes_20.xml[]
----

Элементы `field` компонента `FieldGroup` не имеют атрибута <<gui_attr_stylename,stylename>>, поэтому необходимо задать имя стиля в контроллере:

[source, java]
----
include::{sourcesdir}/gui/themes/themes_21.java[]
----

В файле `halo-ext.scss` добавьте определение нового стиля в mixin `halo-ext`:

[source, css]
----
include::{sourcesdir}/gui/themes/themes_22.scss[]
----

После пересборки проекта поля будут выглядеть следующим образом:

image::gui_themes_fieldgroup_1.png[align="center"]
--

[[web_theme_extension_modify_styles]]
Изменение существующих стилей компонентов::
+
--
Для изменения параметров стиля существующих компонентов необходимо добавить соответствующий код CSS в mixin `halo-ext` файла `halo-ext.scss`. Например, для того, чтобы пункты главного меню отображались жирным шрифтом, содержимое файла `halo-ext.scss` должно быть следующим:

[source, css]
----
include::{sourcesdir}/gui/themes/themes_6.scss[]
----
--

[[web_theme_extension_common]]
Изменение общих параметров::
+
--
Темы содержат переменные SCSS, которые управляют цветом фона, размерами компонентов, отступами и пр.

Рассмотрим пример расширения темы Halo, так как она основана на теме link:https://vaadin.com/valo[Valo] фреймворка *Vaadin*, и предоставляет максимальные возможности адаптации.

Файл `themes/halo/halo-ext-defaults.scss` предназначен для размещения в нем переменных темы. Большинство переменных Halo соответствует описанным в link:https://vaadin.com/api/valo[документации по Valo], ниже приведены основные:

[source, css]
----
include::{sourcesdir}/gui/themes/themes_4.scss[]
----

Пример содержимого файла `halo-ext-defaults.scss` для темы с темным фоном и немного уменьшенными отступами:

[source, css]
----
include::{sourcesdir}/gui/themes/themes_5.scss[]
----
--

[[web_theme_extension_header]]
Изменение заголовка приложения::
+
--
Тема Halo поддерживает свойство приложения <<cuba.web.useInverseHeader,cuba.web.useInverseHeader>>, управляющее цветом заголовка приложения. По умолчанию это свойство установлено в `true`, что задает темный (инверсный) заголовок. В проекте можно не изменяя темы сделать заголовок светлым, установив данное свойство в `false`.
--


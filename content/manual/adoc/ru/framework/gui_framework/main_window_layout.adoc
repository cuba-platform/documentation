:sourcesdir: ../../../../source

[[main_window_layout]]
==== Компоновка главного окна приложения

Механизм предоставляет возможность задавать компоновку главного экрана веб-приложения с использованием технологии универсального пользовательского интерфейса CUBA – XML-дескриптора и Java-контроллера с применением <<gui_vcl,визуальных компонентов>> и <<datasources,источников данных>>.

Главное окно – особый экран системы, имеющий идентификатор `mainWindow`. Контроллер главного экрана должен быть наследником класса `AbstractMainWindow`.

Помимо стандартных компонентов GUI в главном экране приложения можно использовать дополнительные компоненты:

* `AppMenu` – главное меню.

* `FoldersPane` – панель <<folders_pane,папок поиска и папок приложения>>.

* `AppWorkArea` – рабочая область, обязательный компонент для работы с экранами в режимах `++THIS_TAB++`, `++NEW_TAB++` и `++NEW_WINDOW++`.

* `UserIndicator` – поле, отображающее имя текущего пользователя, а при наличии замещаемых пользователей позволяет переключаться между ними.
+
--
Метод `setUserNameFormatter()` используется для отображения имени пользователя в виде, отличном от стандартного имени экземпляра сущности `User`:

[source, java]
----
include::{sourcesdir}/gui/main_window.java[]
----

image::userIndicator.png[align="center"]
--

* `NewWindowButton` – кнопка открытия нового окна приложения.

* `LogoutButton` – кнопка выхода из приложения.

* `TimeZoneIndicator` – надпись, которая отображает <<timeZone,часовой пояс>> пользователя.

* `FtsField` – поле полнотекстового поиска.

Для работы с дополнительными компонентами в XML-дескриптор экрана нужно добавить элемент `xmlns:main`:

[source, xml]
----
include::{sourcesdir}/gui/main_window_1.xml[]
----

Специальный компонент `AppWorkArea` представляет собой рабочую область, в которой открываются экраны приложения. Если свойство приложения <<cuba.web.appWindowMode,cuba.web.appWindowMode>> имеет значение `TABBED` (по умолчанию), то на месте рабочей области будет расположен компонент `TabSheet` с экранами приложения. В противном случае рабочая область будет содержать единственный открытый экран. Свойства приложения <<cuba.web.mainTabSheetMode,cuba.web.mainTabSheetMode>>  и <<cuba.web.managedMainTabSheetMode,cuba.web.managedMainTabSheetMode>> определяют, как будет обрабатываться содержимое вкладок при их переключении. Когда не открыт ни один экран, рабочая область содержит компоненты, определенные во вложенном элементе `initialLayout`:

[source, xml]
----
include::{sourcesdir}/gui/main_window_2.xml[]
---- 

При открытии экранов компоновка начального экрана (`initialLayout`) удаляется из `AppWorkArea`, при закрытии всех экранов – добавляется обратно. Для реакции на события смены рабочей области на стартовый экран и на отображение экранов приложения можно добавить обработчик `AppWorkArea.StateChangeListener`. Например, в таком слушателе можно разместить код обновления данных стартового экрана.

В платформе существуют 2 стандартные реализации главного окна приложения. XML-дескриптор классического окна с верхним горизонтальным меню – `/com/haulmont/cuba/web/app/mainwindow/mainwindow.xml`, соответствующий контроллер – `AppMainWindow`. Также доступна компоновка с <<gui_SideMenu, вертикальным боковым меню>>.

Стандартная реализация главного окна может быть расширена в проекте, так же как обычный экран системы. Пример расширяющего экрана:

[source, xml]
----
include::{sourcesdir}/gui/main_window_3.xml[]
----
--
Этот экран должен быть зарегистрирован в <<screens.xml,web-screens.xml>> с идентификатором `mainWindow`.

Самый простой способ расширить главное окно – использовать соответствующий шаблон в CUBA Studio: выберите *New > Screen* в контекстном меню элемента *Generic UI* в дереве проекта. Затем на вкладке *Legacy Screen Templates* выберите шаблон для нового главного окна. Новый файл `ext-mainwindow.xml` будет создан в модуле Web и автоматически зарегистрирован в`web-screens.xml`.

Реализация главного окна может быть полностью заменена. Например:

[source, xml]
----
include::{sourcesdir}/gui/main_window_4.xml[]
---- 
--
В результате главное окно приложения выглядит следующим образом: 

image::main_window_1.png[align="center"]

Оно же с открытым экраном: 

image::main_window_2.png[align="center"]

Свойство приложения <<cuba.web.showBreadCrumbs,cuba.web.showBreadCrumbs>> позволяет скрыть панель навигации (breadcrumbs) над открытым экраном.


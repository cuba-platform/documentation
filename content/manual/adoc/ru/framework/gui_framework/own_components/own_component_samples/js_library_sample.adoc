:sourcesdir: ../../../../../../source

[[js_library_sample]]
====== Подключение JavaScript библиотеки

В данном примере мы подключим компонент https://jqueryui.com/slider/#range[Slider] из библиотеки *jQuery UI*. Слайдер будет иметь два ползунка, определяющих диапазон значений.

Создайте новый проект в CUBA Studio и назовите его `jscomponent`.

Чтобы создать Slider компонент, необходимо создать следующие файлы:

* `SliderServerComponent` - интегрированный с JavaScript компонент Vaadin.

* `SliderState` - класс состояния компонента Vaadin.

* `slider-connector.js` - JavaScript коннектор для компонента Vaadin

Процесс интеграции компонента в универсальный интерфейс аналогичен описанному в разделе <<vaadin_addon_sample_gui>>, поэтому рассматривать его здесь мы не будем.

Создадим требуемые файлы в подкаталоге `toolkit/ui/slider` модуля *web* и внесем в них необходимые изменения.

* Класс состояния `SliderState` определяет, какие данные будут пересылаться между сервером и клиентом. В нашем случае мы будем пересылать информацию о минимальном и максимальном возможном значении и выбранных значениях слайдера.
+
[source, java]
----
include::{sourcesdir}/ui_component/js/SliderState.java[]
----

* Серверный компонент Vaadin `SliderServerComponent`.
+
[source, java]
----
include::{sourcesdir}/ui_component/js/SliderServerComponent.java[]
----
+
Серверный компонент Vaadin определяет набор геттеров и сеттеров для работы с состоянием слайдера, а также интерфейс слушателя изменения значений. Класс компонента должен быть унаследован от `AbstractJavaScriptComponent`.
+
Метод `addFunction()` в конструкторе класса объявляет обработчик RPC-вызова функции `valueChanged()` с клиента.
+
Аннотации `@JavaScript` и `@WebJarResource` указывают на файлы, которые должны быть загружены на веб-страницу. В нашем примере это JavaScript файлы библиотеки jQuery UI, а также файл со стилями для jQuery UI, расположенные в <<using_webjars,WebJar ресурсе>>, и файл коннектора, расположенный в одном Java-пакете с серверным компонентом.

* JavaScript коннектор `slider-connector.js`.
+
[source, javascript]
----
include::{sourcesdir}/ui_component/js/slider-connector.js[]
----
+
Коннектор представляет собой функцию, которая при загрузке веб-страницы проинициализирует JavaScript компонент. Имя функции должно соответствовать полному имени класса серверного компонента, где точки в имени пакета заменены на символ подчеркивания.
+
Vaadin добавляет ряд полезных методов в функцию коннектора. Например, `this.getElement()` возвращает HTML DOM элемент компонента, `this.getState()` возвращает объект-состояние.
+
В нашем примере коннектор делает следующее:
+
--
* Инициализирует компонент `slider` из библиотеки jQuery UI. При изменении положения одного из ползунков будет вызвана функция `slide()`. Мы видим, что она в свою очередь вызывает метод `valueChanged()` коннектора. `valueChanged()` - это метод, который мы объявили на стороне сервера в классе `SliderServerComponent`.

* Объявляет функцию `onStateChange()`. Она будет вызываться при изменении объекта-состояния на стороне сервера.
--

Для демонстрации работы компонента создадим сущность `Product` с тремя атрибутами:

* `name` типа String
* `minDiscount` типа Double
* `maxDiscount` типа Double

Затем сгенерируем стандартные экраны для данной сущности. Обратите внимание, что мы используем не универсальный компонент платформы, а "нативный" компонент Vaadin. Следовательно, экраны должны располагаться в модуле Web, а не в GUI - укажите это в окне генерации стандартных экранов.

В редакторе сущности мы хотим устанавливать минимальное и максимальное значение скидки с помощью компонента `slider`, который мы только что создали.

Перейдите к файлу `product-edit.xml`. Поля `minDiscount` и `maxDiscount` сделайте нередактируемыми, добавив к соответствующим элементам атрибут `editable="false"`. Затем добавьте компонент `hbox`, который будет использоваться в качестве контейнера для Vaadin компонента.

В результате XML-дескриптор экрана редактирования должен выглядеть следующим образом:

[source, xml]
----
include::{sourcesdir}/ui_component/js/product-edit.xml[]
----

Перейдите к файлу `ProductEdit.java`. Замените его содержимое следующим кодом:

[source, java]
----
include::{sourcesdir}/ui_component/js/ProductEdit.java[]
----

В методе `onInitEntity()` мы проставляем начальные значения скидок для нового продукта.

В методе `onBeforeShow()` инициализируем компонент слайдера. Для компонента слайдера мы проставляем текущие значения, максимальное и минимальное значения, а также объявляем слушатель изменений значений. При движении ползунка мы будем проставлять новые значения скидок в соответствующие поля редактируемой сущности.

Запустите проект и откройте экран редактирования продукта. Изменение положения ползунка на слайдере должно изменять значение в соответствующем текстовом поле.

image::ui_component/product_edit.png[align="center"]

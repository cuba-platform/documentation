:sourcesdir: ../../../../../../source

[[vaadin_addon_sample_gui]]
====== Подключение аддона Vaadin с интеграцией в Generic UI

В <<vaadin_addon_sample,предыдущем разделе>> мы подключили в проект сторонний компонент Stepper. В данном разделе мы интегрируем его в универсальный пользовательский интерфейс CUBA, что даст разработчикам возможность использовать компонент декларативно в XML-дескрипторах экранов и связывать его с сущностями через <<gui_data,Компоненты данных>>.

Чтобы интегрировать Stepper в Generic UI, необходимо создать следующие файлы:

* `Stepper` - интерфейс компонента в подкаталоге *gui* модуля *web*.

* `WebStepper` - реализация компонента в подкаталоге *gui* модуля *web*.

* `StepperLoader` - XML-загрузчик компонента в подкаталоге *gui* модуля *web*.

* `ui-component.xsd` - описатель схемы XML для нового компонента. Если файл уже существует, то информацию о новом компоненте следует добавить в существующий файл.

** `cuba-ui-component.xml` - файл регистрации загрузчика нового компонента в модуле *web*. Если файл уже существует, то информацию о новом компоненте следует добавить в существующий файл.

Откройте проект в IDE.

Создадим требуемые файлы и внесем в них необходимые изменения.

* Создайте интерфейс `Stepper` в подкаталоге *gui* модуля *web*. Замените его содержимое на следующий код:
+
[source, java]
----
include::{sourcesdir}/ui_component/vaadin_gui/Stepper.java[]
----
+
В качестве базового для нашего компонента выбран интерфейс `Field`. Это позволяет осуществить связь с данными (data binding), то есть отображать и редактировать значение некоторого атрибута сущности.

* Создайте класс `WebStepper` - реализации компонента в подкаталоге *gui* модуля *web*. Замените содержимое класса следующим кодом:
+
[source, java]
----
include::{sourcesdir}/ui_component/vaadin_gui/WebStepper.java[]
----
+
В качестве базового класса выбран `WebV8AbstractField`, который реализует логику интерфейса `Field`.

* `StepperLoader` в модуле *web* загружает компонент из его представления в XML.
+
[source, java]
----
include::{sourcesdir}/ui_component/vaadin_gui/StepperLoader.java[]
----
+
Логика загрузки базовых свойств компонента `Field` сосредоточена в классе `AbstractFieldLoader`. Нам достаточно загрузить только специфические свойства `Stepper`.

* В файле `cuba-ui-component.xml`, расположенном в корне модуля *web*, регистрируется новый компонент и его загрузчик. Замените содержимое файла следующим кодом:
+
[source, xml]
----
include::{sourcesdir}/ui_component/vaadin_gui/cuba-ui-component.xml[]
----

* Файл `ui-component.xsd`, расположенный в корне модуля *web*, это описатель XML схемы новых компонентов проекта. Добавьте элемент `stepper` и описание его атрибутов.
+
[source, xml]
----
include::{sourcesdir}/ui_component/vaadin_gui/ui-component.xsd[]
----

Далее рассмотрим, как добавить новый компонент на экран.

* Либо удалите изменения, сделанные в <<vaadin_addon_sample,предыдущем разделе>>, либо сгенерируйте для сущности стандартные экраны.

* Далее добавим компонент `stepper` на экран. Вы можете добавить его как декларативно, так и программно. Рассмотрим оба способа.

. Декларативное использование компонента в XML-декскрипторе.
+
--
* Откройте файл `customer-edit.xml`.

* Объявите новое пространство имен `xmlns:app="http://schemas.company.com/agd/0.1/ui-component.xsd"`

* Удалите поле `score` из `form`.

* Добавьте компонент `stepper` на экран.

В результате XML-дескриптор редактора должен выглядеть так:

[source, xml]
----
include::{sourcesdir}/ui_component/vaadin_gui/customer-edit-gui-declarative.xml[]
----

В данном примере компонент `stepper` подсоединен к атрибуту `score` сущности `Customer`, экземпляр которой находится в источнике данных `customerDc`.
--

. Программное создание в контроллере Java.
+
[source, xml]
----
include::{sourcesdir}/ui_component/vaadin_gui/customer-edit-gui-programmatic.xml[]
----
+
[source, java]
----
include::{sourcesdir}/ui_component/vaadin_gui/CustomerEditGuiProgrammatic.java[]
----

* Запускаем сервер приложения. Экран редактирования должен выглядеть следующим образом:

image::ui_component/customer_edit_result.png[align="center",358,250]

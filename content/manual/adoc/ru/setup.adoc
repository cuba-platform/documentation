[[setup]]
== Установка и настройка инструментария

Минимально необходимым набором программного обеспечения является:

Java SE Development Kit (JDK) 8::
+
--
* Установите Java SE Development Kit (JDK) 8 и проверьте его работоспособность, выполнив в консоли команду

`java -version`

В ответ должно быть выведено сообщение с номером версии Java, например `++1.8.0_152++`.

[WARNING]
====
Java 9 пока не поддерживается. Собирать и запускать CUBA-приложения можно только на Java 8.
====

Для сборки и запуска проектов вне Studio в переменной окружения `++JAVA_HOME++` необходимо установить путь к корневому каталогу JDK, например `C:\Program Files\Java\jdk1.8.0_152`.

* Для *Windows* это можно сделать, открыв *Компьютер* → *Свойства системы* → *Дополнительные параметры системы* → *Дополнительно* → *Переменные среды*, и задав значение переменной в списке *Системные переменные*.

* Для *macOS* `JAVA_HOME` рекомендуется задать в `~/.bash_profile`:
+
`export JAVA_HOME=$(/usr/libexec/java_home -v 1.8)`
+
Если вы установили Java 9 на macOS, CUBA Studio и приложения перестанут запускаться, независимо от значения `JAVA_HOME`. В этом случае обратитесь к информации в разделе <<setup_troubleshooting, решение проблем>> ниже.
--

Cреда разработки на Java::
+
--
*IntelliJ IDEA* или *Eclipse*. Рекомендуется использовать *IntelliJ IDEA* (Community или Ultimate).
--

База данных::
+
--
В простейшем случае в качестве сервера баз данных приложений используется встроенный *HyperSQL* (link:$$http://hsqldb.org$$[http://hsqldb.org]), что вполне подходит для исследования возможностей платформы и прототипирования приложений. Для создания реальных приложений рекомендуется установить и использовать в проекте какую-либо из полноценных СУБД, <<dbms_types,поддерживаемых платформой>>, например *PostgreSQL*.
--

Веб-браузер::
+
--
Веб-интерфейс приложений, создаваемых на основе платформы, поддерживает все популярные современные браузеры, в том числе *Google Chrome*, *Mozilla Firefox*, *Safari*, *Opera 15+*, *Internet Explorer 9+*, *Microsoft Edge*.
--

[[setup_troubleshooting]]
Решение проблем::
+
--
. Если по какой-то причине вы установили Java 9 на macOS, CUBA Studio и приложения перестанут запускаться. Для того, чтобы восстановить работоспособность, выполните следующее:

.. Сделайте инсталляцию JDK 9 не используемой по умолчанию в системе: переименуйте файл `/Library/Java/JavaVirtualMachines/jdk-9.0.1.jdk/Contents/Info.plist` в `Info.plist.disabled` (замените `jdk-9.0.1.jdk` реальной версией вашего JDK 9).

.. Замените `JavaAppletPlugin.plugin`, установленный Java 9 на плагин из Java 8:
*** Удалите или переименуйте `/Library/Internet Plug-Ins/JavaAppletPlugin.plugin`
*** Установите JDK 8 снова, при этом плагин будет переустановлен.

.. Убедитесь что вы указали получение `JAVA_HOME` с аргументом `-v 1.8`, как показано выше. Перелогиньтесь или выполните `source .bash_profile` после внесения изменений.

. Убедитесь, что ваше окружение нe содержит переменных `CATALINA_HOME`, `CATALINA_BASE` и `CLASSPATH`. Эти переменные могут вызвать проблемы с запуском веб-сервера *Apache Tomcat*, который используется во время разработки. Перезагрузите компьютер после удаления переменных.
--

[[cubaStudio_install]]
=== Установка CUBA Studio

Окружение::
+
--
* Убедитесь в том, что на компьютере <<setup,установлен>> Java SE Development Kit (JDK) 8, выполнив в консоли команду
+
`java -version`
+
В ответ должно быть выведено сообщение с номером версии Java, например `++1.8.0_152++`.

* Если вы используете OpenJDK на Linux, установите http://openjdk.java.net/projects/openjfx/[OpenJFX], например:
+
`sudo apt-get install openjfx`

* Если для соединения с интернетом используется прокси-сервер, в JVM, исполняющие Studio и Gradle, необходимо передавать специальные системные свойства Java. Они описаны в документе http://docs.oracle.com/javase/8/docs/technotes/guides/net/proxies.html (см. свойства для протоколов HTTP и HTTPS).
+
Рекомендуется установить нужные свойства в переменной окружения `++JAVA_OPTS++`. Скрипт запуска Studio передает `++JAVA_OPTS++` в `java.exe`.
--

Новая установка Studio::
+
. Загрузите подходящий инсталлятор или ZIP архив со страницы https://www.cuba-platform.ru/download.
+
. Запустите инсталлятор или распакуйте ZIP архив в локальный каталог, например, `c:\work\studio`.
+
. Запустите установленное приложение или откройте командную строку, перейдите в подкаталог `bin` и запустите
`studio.bat` или `studio` в зависимости от вашей операционной системы.
+
. В окне *CUBA Studio Server* введите следующие параметры:
+
--
* *Server port* − порт, на котором будет запущен сервер CUBA Studio (по умолчанию 8111).

* *Remote connection* - по умолчанию Studio принимает соединения только с локального компьютера. Установите данный флажок, если вам нужна возможность подключения к этому экземпляру Studio с удаленного хоста.

* *Silent startup* - если выбрано, сервер Studio запускается в трее и открывает UI в браузере автоматически. Данная опция доступна только в Windows.

image::studio_server_window.png[align="center"]
--
+
. Запустите сервер Studio, нажав кнопку *Start*.
+
Когда запустится веб-сервер, в поле *URL* отобразится адрес, по которому доступен интерфейс Studio. Нажав `→`, можно открыть веб-браузер, нажав *Copy* − скопировать адрес в буфер обмена.
+
. Запустите веб-браузер и перейдите по указанному адресу. В веб-интерфейсе Studio перейдите на вкладку *Settings* и введите следующие параметры:
+
--
* *Java home* − JDK, который будет использоваться для сборки и запуска проектов. Если вы установили переменную окружения `++JAVA_HOME++` как описано в <<setup,начале>> данной главы, ее значение будет подставлено в данное поле. В противном случае Studio попытается самостоятельно найти каталог установки Java.

* *Gradle home* - путь к Gradle. Оставьте поле пустым, в этом случае при первом запуске будет автоматически загружен нужный дистрибутив Gradle.
+
Если по какой-либо причине Вы хотите использовать уже установленный на компьютере Gradle, введите в поле путь к соответствующему каталогу. Текущая версия системы сборки проектов протестирована на *Gradle {gradleVersion}*.

* *IDE port* − порт, на котором принимает подключения плагин IDE (по умолчанию 48561).

* *Offline* - включить возможность работы без интернет-соединения при условии, что все необходимые библиотеки были предварительно загружены из репозитория.

* *Check for updates* - проверять наличие новых версий при старте.

* *Send anonymous statistics and crash reports* - разрешить Studio отправлять статистику ошибок разработчикам.

* *Help language* - язык встроенной справки.

* *Logging level* -  уровень логирования: TRACE, DEBUG, INFO, WARN, ERROR или FATAL. По умолчанию INFO.
--
+
image::studio_server_settings.png[align="center"]
+
. Нажмите *Apply and proceed to projects*.
+
. Нажмите *Create new* для создания нового проекта, или *Import* для добавления имеющегося проекта в список *Recent*.
+
. Сразу после открытия проекта Studio загружает исходный код компонентов платформы, на которых основан проект, и сохраняет его в локальном каталоге. Перед сборкой приложения рекомендуется дождаться окончания загрузки и убедиться в том, что индикатор фоновых задач в левом нижнем углу экрана Studio погас.

Обновление CUBA Studio::
+
--
Если вы обновляете Studio на новую bug-fix версию (например с 6.5.0 на 6.5.1), устанавливайте ее в существующий каталог, например на Windows это будет `C:\Program Files (x86)\CUBA Studio 6.5`. При установке новой minor или major версии, используйте отдельный каталог, например `CUBA Studio 6.6`.

Если Studio установлена из инсталлятора Windows EXE или из ZIP-архива, она поддерживает автообновление на новые bug-fix релизы. Файлы обновлений сохраняются в каталоге `~/.haulmont/studio/update`. В случае каких-либо проблем с новой версией вы можете просто удалить файлы обновления и Studio вернется к версии, установленной ранее вручную.

Автообновление не работает для minor и major релизов, и если Studio была установлена из macOS DMG. В этом случае загрузите и запустите новый инсталлятор вручную.
--

[[ide_integration]]
=== Интеграция CUBA Studio с IDE

Для интеграции с *IntelliJ IDEA* или *Eclipse* выполните следующие шаги:

. Откройте или <<qs_create_project,создайте новый>> проект в Studio.

. Перейдите в секцию *Project properties* и нажмите кнопку *Edit*. Выберите нужную *Java IDE* флажками *IntelliJ IDEA* или *Eclipse*.

. В главном меню Studio выберите пункт меню *Build → Create or update <IDE> project files*. В каталоге проекта будут созданы соответствующие файлы.

. Для интеграции с IntelliJ IDEA:

.. Запустите IntelliJ IDEA 13+ и установите плагин *CUBA Framework Integration*, доступный в репозитории плагинов: *File > Settings > Plugins > Browse Repositories*.

. Для интеграции с Eclipse:

.. Запустите Eclipse 4.3+, откройте *Help > Install New Software*, добавьте репозиторий `++http://files.cuba-platform.com/eclipse-update-site++` и установите плагин *CUBA Plugin*.

.. В Eclipse в меню *Window > Preferences* в секции *CUBA* установите флажок *Studio Integration Enabled* и нажмите на кнопку *OK*.

Обратите внимание, что в панели статуса Studio загорелась надпись *IDE: on port 48561*. Теперь при нажатии кнопок *IDE* в Studio соответствующие файлы исходных кодов будут открываться редактором IDE.


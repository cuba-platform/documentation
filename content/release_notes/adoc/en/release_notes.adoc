= CUBA Platform Release Notes
:toc: left
:toc-title: Table of contents
:toclevels: 6
:sectnumlevels: 6
:stylesheet: cuba.css
:linkcss:
:source-highlighter: coderay
:imagesdir: ./img
:stylesdir: ./styles
:sourcesdir: ../../source
:doctype: book
:sectlinks:
:sectanchors:
:lang: en
:revnumber: 7.2
:version-label: Version
:revremark: Copyright (c) 2019 Haulmont
:youtrack: https://youtrack.cuba-platform.com
:manual: https://doc.cuba-platform.com/manual-{revnumber}
:restapi: https://doc.cuba-platform.com/restapi-{revnumber}
:studio: https://doc.cuba-platform.com/studio
:manual_app_props: https://doc.cuba-platform.com/manual-{revnumber}/app_properties_reference.html#
:reporting: https://doc.cuba-platform.com/reporting-{revnumber}
:charts: https://doc.cuba-platform.com/charts-{revnumber}
:bpm: https://doc.cuba-platform.com/bpm-{revnumber}
:githubissueslog: https://github.com/cuba-platform/documentation/blob/master/content/release_notes/issues

:!sectnums:

[[overview]]
== Overview

This document highlights major changes in CUBA Platform version {revnumber}.

== All Resolved Issues

* {githubissueslog}/release_7.2.0.md[Platform 7.2.0 Resolved Issues]

[[breaking_changes]]
== Breaking Changes

. Due to changes in the "remember me" login mechanism (see <<gui,below>>) all application users will have to enter their credentials when logging in, as if their browser cookies were removed.

. When using {manual}/folders_pane.html[Folders Panel], the _Add to set_ action and button do not appear automatically in the tables linked to the generic filter. If you need this action, add it explicitly as described in the {manual}/record_set.html[Record Sets] section.

. Amazon S3 {manual}/file_storage.html[file storage] implementation has been moved to a separate add-on. See the add-on https://github.com/cuba-platform/cuba-aws[README] for details.

. JGroups has been updated to version 4.1.8.Final. If you use {manual}/cluster_mw.html[middleware cluster], make the following changes in your JGroups configuration files:
** For UDP configuration, replace:
*** `MERGE2` with `MERGE3`
*** `pbcast.NAKACK` with `pbcast.NAKACK2` and remove `retransmit_timeout` property
*** `UNICAST` with `UNICAST3`
*** `FC` with `MFC`
** For TCP configuration, remove properties `timer_type, timer.min_threads, timer.max_threads, timer.keep_alive_time, timer.queue_max_size, thread_pool.queue_enabled, thread_pool.queue_max_size, thread_pool.rejection_policy, oob_thread_pool.min_threads, oob_thread_pool.max_threads, oob_thread_pool.keep_alive_time, oob_thread_pool.queue_enabled, oob_thread_pool.queue_max_size, oob_thread_pool.rejection_policy` and add property `thread_pool.enabled="true"`. See details in http://belaban.blogspot.com/2016/09/removing-thread-pools-in-jgroups-40.html[this article].

. The `DataContext.evictAll()` has been renamed to `evictModified()`, which is a more appropriate name for the method evicting only modified and removed instances. Use the new `clear()` method to evict all instances including modified ones.

[[deployment]]
== Deployment

. Usage of {manual}/app_home.html[Application Home] has been standardized for development and deployment environment. When you start the application in Studio, the application home is created in `deploy/app_home` directory. It contains `conf`, `temp` and `work` directories for all application blocks, as well as the common `logs` directory. The application home also contains the empty `local.app.properties` file and the default logging configuration in `logback.xml`.
+
[WARNING]
====
In order to correctly work with the application home, development Tomcat must define `app.home` Java system property in its `setenv.*` scripts. So remove the old `deploy/tomcat` folder after upgrading to CUBA 7.2 and before running the application. The new Tomcat will be installed automatically.
====
+
Setting `app.home` Java system property is recommended for all deployment variants, however sensible fallback is provided by the framework: it is either the working directory for UberJAR, or `${catalina.base}/work/app_home` when running WAR on Tomcat, or just `~/.app_home` otherwise.

. You can easily provide your own {manual}/logging.html[logging configuration] for the development environment: just create `etc/logback.xml` file in the project, and when you start the application, the file will be copied to `deploy/app_home` and recognized by the logging initialization procedure.

. Now you can configure connections to databases using application properties, see {manual}/db_connection.html[Connecting to Databases]. This method simplifies the overall configuration, because `app.properties` files define all settings including the data source parameters. Also, it makes your WAR file completely independent of the application server environment.
+
Getting data sources from JNDI is supported as before, so no migration is required for existing projects.

. {manual}/spring_profiles.html[Spring profiles] can be used to customize application in different environments.

. OS environment variables can be used as a source of {manual}/app_properties.html#setting_app_properties[application properties] values.

. Redeployment of web applications without restarting the application server works more reliably as a result of using the
https://github.com/mjiderhamn/classloader-leak-prevention[Classloader Leak Prevention] library.

[[security]]
== Security Subsystem

. The new _Strictly denying_ {manual}/roles.html[role] type has been introduced. Unlike _Denying_ role, it denies all permissions _including_ entity attributes. Consider using a default role of this type if your application exposes data through {restapi}[REST API].

[[gui]]
== Generic UI

. The "remember me" login mechanism has been completely reworked:

** The new application property {manual_app_props}cuba.rememberMeExpirationTimeoutSec[cuba.rememberMeExpirationTimeoutSec] defines expiration timeout for "remember me" cookies and `RememberMeToken` entity instances. It is set to 30 days by default.

** If the user selects the _Remember Me_ checkbox in the login screen, next time they log in automatically without showing the login screen.

** If the user logs out explicitly, or the cookie is expired, next time the login screen is shown again.

. {manual}/views_creation.html[Views] used for loading data in screens can be defined right in the screen descriptors, see an example {manual}/gui_data_comp_decl.html[here]. This feature reduces the need for creating shared views in the `views.xml` file.

. {manual}/standard_actions.html[Standard actions] now have parameters that can be configured in XML and Java. So you don't have to rewrite the whole action behavior just to open an editor screen as a dialog, or to specify a different screen class. Use *Component Inspector* in Studio to find and assign action properties and handlers, or copy code snippets from the documentation.

. {manual}/ViewAction.html[ViewAction] allows you to open entity edit screen in read-only mode. The optional `enableEditing` can be used to switch to the edit mode without reopening the screen.

. Introduced {manual}/opening_screens.html#screen_return_values[StandardOutcome] and {manual}/gui_dialogs.html#gui_input_dialog[DialogOutcome] enumerations that can be used instead of `CloseAction` constants when closing screens and testing how the screen or dialog was closed.

. {manual}/gui_Form.html[Form] now supports flexible positioning of fields, see the `colspan` and `rowspan` XML attributes and corresponding parameters of the `add()` method.

. In addition to the global layout template for the generic filter, a layout can be specified for each filter instance, see {manual}/gui_Filter.html#gui_Filter_controlsLayoutTemplate[controlsLayoutTemplate] property.

. {manual}/gui_BulkEditor.html[BulkEditor] has the responsive layout, which you can control using the `columnsMode` attribute.

. In {manual}/gui_DateField.html[DateField], if the new `autofill` attribute is set to true, the current month and year is set automatically after entering a day.

. {manual}/gui_TimeField.html[TimeField] can work in 12h AM/PM format if you set its `timeMode` attribute to `H_12`.

. In {manual}/gui_Table.html[Table] and {manual}/gui_DataGrid.html[DataGrid], you can set initial sorting order declaratively using the `sort` attribute of the `column` element.

. For {manual}/gui_DataGrid.html[DataGrid] and {manual}/gui_TreeDataGrid.html[TreeDataGrid], you can use the following predefined styles: `borderless`, `no-horizontal-lines`, `no-vertical-lines`, `no-stripes`.

. {manual}/gui_PopupView.html[PopupView] supports setting its position using `popupPosition`, `popupTop`, `popupLeft` attributes.

. All tables and data grids now have _Select all_ / _Deselect all_ commands in the columns popup, which simplifies managing long lists of columns.

. {manual}/gui_LookupField.html#gui_LookupField_setOptionImageProvider[setOptionImageProvider] method have been added to `LookupField` and `LookupPickerField`. It allows you to display images for the field options (previously only icons could be used). Go to _Handlers_ tab in Studio component inspector and double-click _optionImageProvider_ field to generate handler code.

. {manual}/gui_Button.html[Button] has its own `shortcut` attribute, which allows you to assign keyboard shortcuts to buttons not linked to actions.

. The new {manual}/gui_components.html[Slider] component has been implemented.

. If you set the `autoLoad` attribute of {manual}/gui_Table.html#gui_Table_rowsCount[RowsCount] to true, the component will load the number of rows in background and show it automatically.

. {manual}/gui_Filter.html[Filter] component can now work with {manual}/gui_keyvalue_containers.html[KeyValueCollectionContainer] loaders.

[[misc]]
== Miscellaneous

. JUnit 5 is used in new projects for tests. The {manual}/testing.html[documentation] has been updated accordingly.

. {manual}/views_creation.html[ViewBuilder] simplifies creation of views in the business logic and tests.

. {manual}/dataManager.html#dm_query[DataManager]'s fluent interface allows you to specify JPQL queries in abbreviated format omitting parts of the query that can be inferred from the context.

. Listeners of {manual}/entity_attr_annotations.html#metaProperty_annotation[read-only transient properties] are now notified when related properties change. It helps to update UI components displaying read-only attributes that depend on some other mutable attributes.

[[upd_dep]]
== Updated Dependencies

Core framework:
----
----

Reports add-on:
----
----
